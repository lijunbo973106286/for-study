<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.woniuxy.user.dao.MenuDao">
    <insert id="roleMenu">
        insert into scfp_role_menu values
        <foreach collection="menu_id" close="" index="" item="item" separator="," open="">
            (#{role_id},#{item})
        </foreach>
    </insert>
    <delete id="delete">
        delete
        from scfp_role_menu
        where role_id = #{role_id}
    </delete>
    <!--    查询用户全部菜单-->
    <resultMap id="MenuList" type="com.woniuxy.user.entity.ScfpMenu">
        <id column="id" property="id"/>
        <result column="menuname" property="menuname"/>
        <result column="url" property="url"/>
        <collection property="menus" select="findChild" column="id" autoMapping="true"/>
    </resultMap>
    <!--    一级菜单-->
    <select id="findAll" resultMap="MenuList">
        select id, menuname, url, fid
        from scfp_menu
        where fid is null
          and id in
              (select distinct menu_id
               from scfp_role_menu rm
                        left join scfp_user_role ru on rm.role_id = ru.role_id
               where user_id = #{id})
    </select>
    <!--    子菜单-->
    <select id="findChild" resultMap="MenuList">
        select id, menuname, url, fid
        from scfp_menu
        where fid = #{id}
          and id in
              (select distinct menu_id
               from scfp_role_menu rm
                        left join scfp_user_role ru on rm.role_id = ru.role_id
              );
    </select>
    <!--    查询全部查单 &#45;&#45; 完-->


    <select id="findMenuById" resultType="java.lang.Integer">
        select menu_id
        from scfp_role_menu
        where role_id = #{role_id}
    </select>
</mapper>